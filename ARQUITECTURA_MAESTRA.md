# üè≠ CRGM-API - ARQUITECTURA MAESTRA DEL SISTEMA
## Sistema Operativo Industrial Completo

**Fecha de Creaci√≥n**: 10 Febrero 2026  
**Versi√≥n**: 1.0.0  
**Concepto**: Plataforma de Gesti√≥n Industrial con PWA, Sincronizaci√≥n P2P y Seguridad Soberana

---

## üìã √çNDICE MAESTRO DE M√ìDULOS

### NIVEL 0: FUNDAMENTOS (Infraestructura Cr√≠tica)
- **0.1** PWA Offline-First (Progressive Web App)
- **0.2** Sistema de Tokens Descentralizados
- **0.3** Criptograf√≠a y Ofuscaci√≥n de Archivos
- **0.4** Protocolo "Zas" (Sincronizaci√≥n P2P)
- **0.5** Sistema de Respaldos Anti-Borrado

### NIVEL 1: EDITOR DE DIAGRAMAS EL√âCTRICOS
- **1.1** Canvas/SVG de 10 Columnas (Est√°ndar Europeo IEC)
- **1.2** Librer√≠a de S√≠mbolos El√©ctricos (IEC 60617)
- **1.3** Auto-Cableado Inteligente
- **1.4** Referencias Cruzadas (Contactos ‚Üî Bobinas)
- **1.5** Gesti√≥n de Hojas Multi-P√°gina
- **1.6** M√≥dulos PLC (Entradas/Salidas de 8 bits)
- **1.7** Tarjetas Anal√≥gicas y Encoders
- **1.8** Exportaci√≥n a PDF con Cajet√≠n Profesional
- **1.9** Lista de Materiales (BOM) Autom√°tica
- **1.10** Lista de Cables Autom√°tica
- **1.11** Simulaci√≥n El√©ctrica (Flujo de corriente)
- **1.12** C√°lculo de Ca√≠da de Tensi√≥n
- **1.13** Curvas de Disparo de Protecciones
- **1.14** Importaci√≥n desde PDF/Excel

### NIVEL 2: GESTI√ìN DE PROYECTOS
- **2.1** Jerarqu√≠a: Empresa > √Årea > M√°quina > Secci√≥n > Equipo
- **2.2** Estados de Proyecto (Propuesta ‚Üí Implementaci√≥n ‚Üí Implementado)
- **2.3** Sistema de Cotizaciones M√∫ltiples
- **2.4** Asignaci√≥n de Tareas a T√©cnicos
- **2.5** Cronograma Estimado vs Real (Valor Ganado)
- **2.6** Audit Trail (Historial de Cambios)
- **2.7** Control de Versiones (Git para Electricistas)
- **2.8** Sistema de Tokens Temporales (C√≥digos de Jornada)
- **2.9** Chat Contextual (Telegram de Planta)
- **2.10** Organigrama Din√°mico Desplegable

### NIVEL 3: INVENTARIO Y MATERIALES
- **3.1** Kardex de Repuestos con Costos Unitarios
- **3.2** Control de Entradas/Salidas por JSON
- **3.3** Trazabilidad de Consumo por M√°quina/Proyecto
- **3.4** Punto de Reorden (ROP) Autom√°tico
- **3.5** Inventario Distribuido (Bodega + Maletines)
- **3.6** Gesti√≥n de Herramientas F√≠sicas
- **3.7** Control de Calibraci√≥n de Instrumentos
- **3.8** Escudo de Garant√≠as de Repuestos
- **3.9** Inventario de Materias Primas (Papel, B√∫nker, Gas)
- **3.10** Gesti√≥n de Obsolescencia (Reemplazar y Actualizar)

### NIVEL 4: PRODUCCI√ìN Y OEE
- **4.1** Registro de √ìrdenes de Producci√≥n
- **4.2** Control de Operadores por Turno
- **4.3** Cron√≥metro SMED (Single-Minute Exchange)
- **4.4** C√°lculo de OEE (Overall Equipment Effectiveness)
- **4.5** Registro de Desperdicio (Scrap)
- **4.6** Control de Consumo Energ√©tico (B√∫nker/Gas/Vapor)
- **4.7** Indicadores Lean Manufacturing
- **4.8** An√°lisis Pareto (80/20)
- **4.9** Dashboard de Producci√≥n en Tiempo Real

### NIVEL 5: MANTENIMIENTO
- **5.1** M√≥dulo LOTO Digital (Lockout/Tagout)
- **5.2** Expediente Digital de Activos (Asset Management)
- **5.3** Geolocalizaci√≥n GPS de Eventos
- **5.4** Registro de Fallas por Voz
- **5.5** C√°lculo de MTBF/MTTR
- **5.6** Confiabilidad por Repuesto R(t)
- **5.7** Mantenimiento Preventivo Programado
- **5.8** Autodiagn√≥stico de Dispositivos
- **5.9** Alertas Sensoriales (Sonido + Vibraci√≥n)
- **5.10** Biblioteca T√©cnica Offline (Manuales PDF)

### NIVEL 6: REALIDAD AUMENTADA
- **6.1** Esc√°ner Universal de QR/NFC
- **6.2** Etiquetas Flotantes (Anchor AR)
- **6.3** Ghost Layer (Superposici√≥n Antes/Despu√©s)
- **6.4** Notas Espaciales (Dibujo en 3D)
- **6.5** HUD de Inventario en Tiempo Real
- **6.6** Detecci√≥n de Diferencias Visuales

### NIVEL 7: SINCRONIZACI√ìN Y RESILIENCIA
- **7.1** Protocolo Gossip (Propagaci√≥n Viral)
- **7.2** Handshake Silencioso (Identidades Ef√≠meras)
- **7.3** Delta Bundles (Archivos < 2KB)
- **7.4** Sync Multi-Canal (Cloud + P2P + Bluetooth)
- **7.5** L√≠nea de Tiempo de Sincronizaci√≥n
- **7.6** Monitor de Salud de Red (Œ® Index)
- **7.7** Bloqueo de Conflictos (Optimistic Locking)
- **7.8** Sistema de Recuperaci√≥n con Token Rey
- **7.9** Instalaci√≥n sin Internet (Servidor Local)
- **7.10** Exportaci√≥n/Importaci√≥n Manual (.crgm-pack)

### NIVEL 8: SEGURIDAD Y CONTROL
- **8.1** Ofuscaci√≥n de Archivos (.sys, .dll, .dat)
- **8.2** Diccionarios Din√°micos por Sesi√≥n
- **8.3** Firma Digital (HMAC-SHA256)
- **8.4** Matriz de Permisos por Token
- **8.5** Llave Maestra F√≠sica (Semilla de G√©nesis)
- **8.6** Monitor de Actividad en Vivo
- **8.7** Bot√≥n de Lockdown de Emergencia
- **8.8** Auditor√≠a de Accesos (Access Logs)
- **8.9** Validaci√≥n de Integridad de Archivos

### NIVEL 9: AN√ÅLISIS Y REPORTES
- **9.1** Dashboard Rey (Vista Ejecutiva)
- **9.2** Dashboard de Campo (Vista T√©cnica)
- **9.3** Indicadores Six Sigma (Cp, Cpk, DPMO)
- **9.4** Reportes Ejecutivos Autom√°ticos (PDF)
- **9.5** An√°lisis de Variabilidad
- **9.6** Control de Costos por Activo
- **9.7** M√≥dulo de Auditor√≠a 5S
- **9.8** Planificaci√≥n de Reinversi√≥n
- **9.9** Registro de Mejoras Kaizen

### NIVEL 10: OPTIMIZACI√ìN DE RECURSOS
- **10.1** Gesti√≥n de Bater√≠a Adaptativa
- **10.2** Control T√©rmico de Dispositivos
- **10.3** Compresi√≥n de Datos (MessagePack/ProtoBuf)
- **10.4** Cache Inteligente (LRU)
- **10.5** Lazy Loading de M√≥dulos

---

## üóÇÔ∏è ESTRUCTURA DE ARCHIVOS DEL PROYECTO

```
CRGM-API/
‚îÇ
‚îú‚îÄ‚îÄ üìÑ CRGM API DEV.txt           # Documento de conversaci√≥n completa
‚îú‚îÄ‚îÄ üìÑ ARQUITECTURA_MAESTRA.md    # Este documento (√çndice maestro)
‚îú‚îÄ‚îÄ üìÑ CHECKLIST_DESARROLLO.md    # Lista de tareas detallada
‚îú‚îÄ‚îÄ üìÑ README.md                  # Documentaci√≥n principal
‚îÇ
‚îú‚îÄ‚îÄ üìÅ Diagramas Electricos/      # PDFs de referencia Fosber
‚îÇ
‚îú‚îÄ‚îÄ üìÅ Modulos/                   # M√≥dulos del sistema
‚îÇ   ‚îú‚îÄ‚îÄ SMED/                     # Aplicaci√≥n SMED existente
‚îÇ   ‚îî‚îÄ‚îÄ Tools/                    # Herramientas varias
‚îÇ
‚îú‚îÄ‚îÄ üìÅ docs/                      # Documentaci√≥n t√©cnica
‚îÇ   ‚îú‚îÄ‚îÄ API_REFERENCE.md
‚îÇ   ‚îú‚îÄ‚îÄ USER_GUIDE.md
‚îÇ   ‚îî‚îÄ‚îÄ DEPLOYMENT_GUIDE.md
‚îÇ
‚îî‚îÄ‚îÄ üìÅ src/                       # C√≥digo fuente principal
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ manifest.json
    ‚îú‚îÄ‚îÄ sw.js
    ‚îÇ
    ‚îú‚îÄ‚îÄ css/
    ‚îÇ   ‚îî‚îÄ‚îÄ industrial.css
    ‚îÇ
    ‚îú‚îÄ‚îÄ js/
    ‚îÇ   ‚îú‚îÄ‚îÄ app.js               # Controlador principal
    ‚îÇ   ‚îú‚îÄ‚îÄ database.js          # IndexedDB Manager
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ modules/
    ‚îÇ       ‚îú‚îÄ‚îÄ scanner.js       # QR/NFC Scanner
    ‚îÇ       ‚îú‚îÄ‚îÄ loto.js          # Seguridad LOTO
    ‚îÇ       ‚îú‚îÄ‚îÄ assets.js        # Gesti√≥n de Activos
    ‚îÇ       ‚îú‚îÄ‚îÄ inventory.js     # Inventario Valorado
    ‚îÇ       ‚îú‚îÄ‚îÄ diagrams.js      # Editor SVG
    ‚îÇ       ‚îú‚îÄ‚îÄ zas.js           # Protocolo P2P
    ‚îÇ       ‚îú‚îÄ‚îÄ backup.js        # Sistema de Respaldos
    ‚îÇ       ‚îú‚îÄ‚îÄ projects.js      # Gesti√≥n de Proyectos
    ‚îÇ       ‚îú‚îÄ‚îÄ production.js    # OEE y SMED
    ‚îÇ       ‚îú‚îÄ‚îÄ ar-overlay.js    # Realidad Aumentada
    ‚îÇ       ‚îú‚îÄ‚îÄ analytics.js     # Six Sigma y Reportes
    ‚îÇ       ‚îî‚îÄ‚îÄ tokens.js        # Sistema de Autenticaci√≥n
    ‚îÇ
    ‚îú‚îÄ‚îÄ assets/
    ‚îÇ   ‚îú‚îÄ‚îÄ icons/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-192.png
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-512.png
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ favicon.ico
    ‚îÇ   ‚îú‚îÄ‚îÄ sounds/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ industrial-alert.mp3
    ‚îÇ   ‚îî‚îÄ‚îÄ symbols/
    ‚îÇ       ‚îî‚îÄ‚îÄ iec-library.svg  # S√≠mbolos el√©ctricos
    ‚îÇ
    ‚îî‚îÄ‚îÄ lib/
        ‚îú‚îÄ‚îÄ html5-qrcode.min.js
        ‚îú‚îÄ‚îÄ qrcode.min.js
        ‚îî‚îÄ‚îÄ pdf.min.js

```

---

## üîê MODELO DE SEGURIDAD

### Ofuscaci√≥n de Archivos en Google Drive
Los archivos reales se guardan con nombres despistados:

| Archivo Real | Nombre Ofuscado | Extensi√≥n |
|--------------|----------------|-----------|
| proyecto_001.json | sys_cache_v4.dat | .dat |
| inventario.json | kernel_ext_32.sys | .sys |
| presupuesto.json | ms_vcomp_140.dll | .dll |
| chat_gerente.json | error_dump_stack.log | .log |

### Mapa de Traducci√≥n (Solo accesible con Token Rey)
El archivo `map_index.sys` contiene la tabla de traducci√≥n. Sin este archivo, los dem√°s son ruido ininteligible.

---

## üéØ OBJETIVOS PRINCIPALES

1. **Resiliencia Total**: Funcionar sin internet mediante P2P
2. **Seguridad Soberana**: Datos protegidos por ofuscaci√≥n y criptograf√≠a
3. **Trazabilidad Brutal**: Cada centavo, tornillo y minuto registrado
4. **Escalabilidad**: Sistema modular que crece con la empresa
5. **Simplicidad de Uso**: Interfaz intuitiva para t√©cnicos en campo

---

## üìä TECNOLOG√çAS CLAVE

- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **Almacenamiento**: IndexedDB + LocalStorage
- **Sincronizaci√≥n**: WebRTC, Web Bluetooth API, Google Drive API
- **Realidad Aumentada**: WebGL, Canvas API, getUserMedia
- **Offline**: Service Workers, Cache API
- **Seguridad**: Web Crypto API, HMAC-SHA256
- **Geolocalizaci√≥n**: Geolocation API, GPS
- **Audio**: Web Audio API (Alertas psicoac√∫sticas)

---

## ‚ö° FILOSOF√çA DE DISE√ëO

### "Zas" - El Coraz√≥n del Sistema
Sincronizaci√≥n instant√°nea mediante:
1. Acercamiento de dispositivos (Bluetooth/NFC)
2. Red local Wi-Fi (sin internet)
3. Nube cuando hay conexi√≥n
4. Transferencia manual (USB/SD)

### "Estandarizaci√≥n Brutal"
- Todos ven la misma informaci√≥n al mismo tiempo
- No hay puntos ciegos financieros u operativos
- La verdad es √∫nica y distribuida

### "Offline-First"
- Internet es opcional, no obligatorio
- Cada dispositivo es un servidor aut√≥nomo
- Los datos sobreviven a cualquier desastre

---

## üîÑ FLUJO DE DATOS

```
T√âCNICO (Campo)
    ‚Üì Escanea QR
    ‚Üì Reporta Falla + GPS
    ‚Üì Usa Repuesto
    ‚Üì Genera Delta.sys (2KB)
    ‚Üì
[SINCRONIZACI√ìN "ZAS"]
    ‚Üì P2P Bluetooth/WiFi
    ‚Üì Propagaci√≥n Viral
    ‚Üì
DASHBOARD REY (Control)
    ‚Üì Consolidaci√≥n
    ‚Üì Validaci√≥n de Firma
    ‚Üì Actualizaci√≥n de Maestros
    ‚Üì
REPORTES (Socios/Gerencia)
    ‚Üì PDF Ejecutivo
    ‚Üì KPIs Six Sigma
    ‚Üì An√°lisis Lean
```

---

## üíæ MODELO DE DATOS (IndexedDB)

### Object Stores (Cajas de Memoria)

1. **assets** - M√°quinas y Equipos
   - ID, Nombre, Ubicaci√≥n GPS, Manuales PDF, Fotos

2. **logs** - Historial Universal
   - Timestamp, Tipo, Usuario, Detalles, GPS, Costo

3. **inventory** - Kardex Valorado
   - ID, Nombre, Stock, Costo Unitario, Ubicaci√≥n

4. **diagrams** - Planos El√©ctricos
   - ID, SVG Data, Hoja, BOM, Lista de Cables

5. **deltas** - Cola de Sincronizaci√≥n
   - Hash, Payload, Timestamp, Destinatario, Estado

6. **projects** - Proyectos y Sub-Proyectos
   - ID, Estado, Presupuesto, Timeline, Responsables

7. **users** - Perfiles y Tokens
   - ID, Nombre, Nivel, Permisos, √öltima Sincronizaci√≥n

---

## üõ°Ô∏è SISTEMA DE RESPALDOS (Anti-Borrado)

### Estrategia de 4 Capas

1. **Capa 1**: LocalStorage (Datos cr√≠ticos m√≠nimos)
2. **Capa 2**: IndexedDB (Base de datos principal)
3. **Capa 3**: Exportaci√≥n a Descargas (.crgm.json)
4. **Capa 4**: Google Drive (Sincronizaci√≥n nube)

### Protocolo de Recuperaci√≥n

```javascript
// Orden de prioridad al restaurar:
1. Buscar archivo .crgm en Descargas
2. Si no existe, buscar en Google Drive
3. Si no hay conexi√≥n, buscar dispositivos cercanos (P2P)
4. Si todo falla, usar Token Rey para reconstruir estructura vac√≠a
```

---

## üé® DISE√ëO DE INTERFAZ

### Modo Oscuro Industrial
- **Fondo**: Negro Puro (#000000)
- **Texto**: Gris Platino (#E0E0E0)
- **Acentos**:
  - Verde Ne√≥n: √âxito/Disponible (#00FF41)
  - Rojo: Peligro/Bloqueo (#FF3300)
  - √Åmbar: Advertencia (#FF9900)
  - Cyan: Informaci√≥n (#00DDFF)

### Principios de UX
- Botones grandes (m√≠nimo 44x44px) para uso con guantes
- Contraste alto para luz solar directa
- Fuente monoespaciada para datos t√©cnicos
- Vibraci√≥n h√°ptica para confirmaciones

---

## üì± COMPATIBILIDAD

### Navegadores Soportados
- Chrome/Edge 90+ (Recomendado)
- Safari 14+ (iOS)
- Firefox 88+

### Hardware M√≠nimo
- 2GB RAM
- 500MB espacio libre
- C√°mara trasera
- GPS
- Aceler√≥metro

---

## üöÄ PR√ìXIMOS PASOS DE DESARROLLO

Ver archivo `CHECKLIST_DESARROLLO.md` para la lista detallada de implementaci√≥n.

---

**Creado por**: CRGM Industrial Solutions  
**Contacto**: smed@crgm.app  
**Licencia**: Propietaria (C√≥digo Cerrado)
